<!DOCTYPE html>
<html lang="zh-CN" class="scroll-smooth">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CF Workers SUB - 订阅管理器</title>
    <meta name="description" content="现代化的订阅节点聚合和转换服务">
    
    <!-- Tailwind CSS CDN -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- Alpine.js for reactivity -->
    <script defer src="https://cdn.jsdelivr.net/npm/alpinejs@3.x.x/dist/cdn.min.js"></script>
    
    <!-- Icons -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/heroicons@2.0.18/20/solid/index.css">
    
    <!-- Custom Tailwind Config -->
    <script>
        tailwind.config = {
            darkMode: 'class',
            theme: {
                extend: {
                    colors: {
                        primary: {
                            50: '#eff6ff',
                            500: '#3b82f6',
                            600: '#2563eb',
                            700: '#1d4ed8',
                            900: '#1e3a8a'
                        },
                        gray: {
                            50: '#f9fafb',
                            100: '#f3f4f6',
                            800: '#1f2937',
                            900: '#111827'
                        }
                    },
                    animation: {
                        'fade-in': 'fadeIn 0.5s ease-in-out',
                        'slide-up': 'slideUp 0.3s ease-out',
                        'pulse-slow': 'pulse 3s infinite'
                    }
                }
            }
        }
    </script>
    
    <!-- Custom Styles -->
    <style>
        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }
        
        @keyframes slideUp {
            from { transform: translateY(20px); opacity: 0; }
            to { transform: translateY(0); opacity: 1; }
        }
        
        .glass-effect {
            backdrop-filter: blur(10px);
            background: rgba(255, 255, 255, 0.1);
            border: 1px solid rgba(255, 255, 255, 0.2);
        }
        
        .dark .glass-effect {
            background: rgba(0, 0, 0, 0.3);
            border: 1px solid rgba(255, 255, 255, 0.1);
        }
    </style>
</head>
<body class="bg-gradient-to-br from-blue-50 via-white to-purple-50 dark:from-gray-900 dark:via-gray-800 dark:to-blue-900 min-h-screen transition-all duration-300"
      x-data="subManager()" 
      x-init="init()">
    
    <!-- Navigation -->
    <nav class="fixed top-0 w-full z-50 glass-effect">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
            <div class="flex justify-between items-center h-16">
                <!-- Logo -->
                <div class="flex items-center space-x-3">
                    <div class="w-8 h-8 bg-gradient-to-br from-blue-500 to-purple-600 rounded-lg flex items-center justify-center">
                        <svg class="w-5 h-5 text-white" fill="currentColor" viewBox="0 0 24 24">
                            <path d="M12 2L2 7v10c0 5.55 3.84 9.74 9 11 5.16-1.26 9-5.45 9-11V7l-10-5z"/>
                        </svg>
                    </div>
                    <h1 class="text-xl font-bold bg-gradient-to-r from-blue-600 to-purple-600 bg-clip-text text-transparent">
                        CF Workers SUB
                    </h1>
                </div>
                
                <!-- Theme Toggle & Status -->
                <div class="flex items-center space-x-4">
                    <!-- Status Indicator -->
                    <div class="flex items-center space-x-2">
                        <div class="w-2 h-2 bg-green-500 rounded-full animate-pulse"></div>
                        <span class="text-sm text-gray-600 dark:text-gray-300">在线</span>
                    </div>
                    
                    <!-- Dark Mode Toggle -->
                    <button @click="toggleDarkMode()" 
                            class="p-2 rounded-lg bg-white/80 dark:bg-gray-800/80 hover:bg-white dark:hover:bg-gray-700 transition-all duration-200">
                        <svg x-show="!darkMode" class="w-5 h-5 text-gray-600" fill="currentColor" viewBox="0 0 24 24">
                            <path d="M12 2.25a.75.75 0 01.75.75v2.25a.75.75 0 01-1.5 0V3a.75.75 0 01.75-.75zM7.5 12a4.5 4.5 0 119 0 4.5 4.5 0 01-9 0zM18.894 6.166a.75.75 0 00-1.06-1.06l-1.591 1.59a.75.75 0 101.06 1.061l1.591-1.59zM21.75 12a.75.75 0 01-.75.75h-2.25a.75.75 0 010-1.5H21a.75.75 0 01.75.75zM17.834 18.894a.75.75 0 001.06-1.06l-1.59-1.591a.75.75 0 10-1.061 1.06l1.59 1.591zM12 18a.75.75 0 01.75.75V21a.75.75 0 01-1.5 0v-2.25A.75.75 0 0112 18zM7.758 17.303a.75.75 0 00-1.061-1.06l-1.591 1.59a.75.75 0 001.06 1.061l1.591-1.59zM6 12a.75.75 0 01-.75.75H3a.75.75 0 010-1.5h2.25A.75.75 0 016 12zM6.697 7.757a.75.75 0 001.06-1.06l-1.59-1.591a.75.75 0 00-1.061 1.06l1.59 1.591z"/>
                        </svg>
                        <svg x-show="darkMode" class="w-5 h-5 text-gray-300" fill="currentColor" viewBox="0 0 24 24">
                            <path d="M9.528 1.718a.75.75 0 01.162.819A8.97 8.97 0 009 6a9 9 0 009 9 8.97 8.97 0 003.463-.69.75.75 0 01.981.98 10.503 10.503 0 01-9.694 6.46c-5.799 0-10.5-4.701-10.5-10.5 0-4.368 2.667-8.112 6.46-9.694a.75.75 0 01.818.162z"/>
                        </svg>
                    </button>
                </div>
            </div>
        </div>
    </nav>

    <!-- Main Content -->
    <main class="pt-20 pb-12">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
            
            <!-- Hero Section -->
            <div class="text-center mb-12 animate-fade-in">
                <h2 class="text-4xl font-bold text-gray-900 dark:text-white mb-4">
                    现代化订阅管理
                </h2>
                <p class="text-xl text-gray-600 dark:text-gray-300 max-w-3xl mx-auto">
                    聚合多个订阅源，支持多种客户端格式转换，提供统一的订阅管理解决方案
                </p>
            </div>

            <!-- Authentication Section -->
            <div x-show="!isAuthenticated" class="max-w-md mx-auto mb-8 animate-slide-up">
                <div class="bg-white/80 dark:bg-gray-800/80 backdrop-blur-sm rounded-2xl shadow-xl p-8 border border-white/20">
                    <div class="text-center mb-6">
                        <div class="w-16 h-16 bg-gradient-to-br from-blue-500 to-purple-600 rounded-full mx-auto mb-4 flex items-center justify-center">
                            <svg class="w-8 h-8 text-white" fill="currentColor" viewBox="0 0 24 24">
                                <path d="M18 1.5c2.9 0 5.2 2.3 5.2 5.2v1.3c0 2.9-2.3 5.2-5.2 5.2H6c-2.9 0-5.2-2.3-5.2-5.2V6.7C.8 3.8 3.1 1.5 6 1.5h12z"/>
                            </svg>
                        </div>
                        <h3 class="text-2xl font-bold text-gray-900 dark:text-white">身份验证</h3>
                        <p class="text-gray-600 dark:text-gray-400 mt-2">请输入你的访问令牌</p>
                    </div>
                    
                    <form @submit.prevent="authenticate()">
                        <div class="mb-6">
                            <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">
                                访问令牌
                            </label>
                            <input 
                                x-model="token"
                                type="password" 
                                placeholder="输入你的令牌..."
                                class="w-full px-4 py-3 border border-gray-300 dark:border-gray-600 rounded-xl focus:ring-2 focus:ring-blue-500 focus:border-transparent bg-white dark:bg-gray-700 text-gray-900 dark:text-white transition-all duration-200"
                                required
                            >
                        </div>
                        
                        <button 
                            type="submit"
                            :disabled="loading"
                            class="w-full bg-gradient-to-r from-blue-500 to-purple-600 text-white py-3 px-6 rounded-xl font-medium hover:shadow-lg transform hover:scale-[1.02] transition-all duration-200 disabled:opacity-50 disabled:cursor-not-allowed">
                            <span x-show="!loading">验证并继续</span>
                            <span x-show="loading" class="flex items-center justify-center">
                                <svg class="animate-spin -ml-1 mr-3 h-5 w-5 text-white" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24">
                                    <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle>
                                    <path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path>
                                </svg>
                                验证中...
                            </span>
                        </button>
                    </form>
                </div>
            </div>

            <!-- Dashboard -->
            <div x-show="isAuthenticated" class="space-y-8">
                
                <!-- Stats Cards -->
                <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6">
                    <div class="bg-white/80 dark:bg-gray-800/80 backdrop-blur-sm rounded-2xl p-6 shadow-lg border border-white/20">
                        <div class="flex items-center justify-between">
                            <div>
                                <p class="text-sm font-medium text-gray-600 dark:text-gray-400">总访问次数</p>
                                <p class="text-3xl font-bold text-gray-900 dark:text-white" x-text="stats.totalAccess || 0"></p>
                            </div>
                            <div class="w-12 h-12 bg-blue-100 dark:bg-blue-900/30 rounded-xl flex items-center justify-center">
                                <svg class="w-6 h-6 text-blue-600 dark:text-blue-400" fill="currentColor" viewBox="0 0 24 24">
                                    <path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm-2 15l-5-5 1.41-1.41L10 14.17l7.59-7.59L19 8l-9 9z"/>
                                </svg>
                            </div>
                        </div>
                    </div>
                    
                    <div class="bg-white/80 dark:bg-gray-800/80 backdrop-blur-sm rounded-2xl p-6 shadow-lg border border-white/20">
                        <div class="flex items-center justify-between">
                            <div>
                                <p class="text-sm font-medium text-gray-600 dark:text-gray-400">可用节点</p>
                                <p class="text-3xl font-bold text-gray-900 dark:text-white" x-text="nodeCount || 0"></p>
                            </div>
                            <div class="w-12 h-12 bg-green-100 dark:bg-green-900/30 rounded-xl flex items-center justify-center">
                                <svg class="w-6 h-6 text-green-600 dark:text-green-400" fill="currentColor" viewBox="0 0 24 24">
                                    <path d="M12 2l3.09 6.26L22 9.27l-5 4.87 1.18 6.88L12 17.77l-6.18 3.25L7 14.14 2 9.27l6.91-1.01L12 2z"/>
                                </svg>
                            </div>
                        </div>
                    </div>
                    
                    <div class="bg-white/80 dark:bg-gray-800/80 backdrop-blur-sm rounded-2xl p-6 shadow-lg border border-white/20">
                        <div class="flex items-center justify-between">
                            <div>
                                <p class="text-sm font-medium text-gray-600 dark:text-gray-400">订阅链接</p>
                                <p class="text-3xl font-bold text-gray-900 dark:text-white" x-text="subscriptionLinks.length || 0"></p>
                            </div>
                            <div class="w-12 h-12 bg-purple-100 dark:bg-purple-900/30 rounded-xl flex items-center justify-center">
                                <svg class="w-6 h-6 text-purple-600 dark:text-purple-400" fill="currentColor" viewBox="0 0 24 24">
                                    <path d="M19 19H5V5h7V3H5c-1.11 0-2 .9-2 2v14c0 1.1.89 2 2 2h14c1.11 0 2-.9 2-2v-7h-2v7zM14 3v2h3.59l-9.83 9.83 1.41 1.41L19 6.41V10h2V3h-7z"/>
                                </svg>
                            </div>
                        </div>
                    </div>
                    
                    <div class="bg-white/80 dark:bg-gray-800/80 backdrop-blur-sm rounded-2xl p-6 shadow-lg border border-white/20">
                        <div class="flex items-center justify-between">
                            <div>
                                <p class="text-sm font-medium text-gray-600 dark:text-gray-400">服务状态</p>
                                <p class="text-3xl font-bold text-green-600 dark:text-green-400">正常</p>
                            </div>
                            <div class="w-12 h-12 bg-orange-100 dark:bg-orange-900/30 rounded-xl flex items-center justify-center">
                                <svg class="w-6 h-6 text-orange-600 dark:text-orange-400" fill="currentColor" viewBox="0 0 24 24">
                                    <path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm-2 15l-5-5 1.41-1.41L10 14.17l7.59-7.59L19 8l-9 9z"/>
                                </svg>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Tabs -->
                <div class="bg-white/80 dark:bg-gray-800/80 backdrop-blur-sm rounded-2xl shadow-lg border border-white/20">
                    <div class="border-b border-gray-200 dark:border-gray-700">
                        <nav class="flex space-x-8 px-6">
                            <button 
                                @click="currentTab = 'subscription'"
                                :class="currentTab === 'subscription' ? 'border-blue-500 text-blue-600 dark:text-blue-400' : 'border-transparent text-gray-500 hover:text-gray-700 dark:text-gray-400'"
                                class="py-4 px-1 border-b-2 font-medium text-sm transition-colors duration-200">
                                订阅管理
                            </button>
                            <button 
                                @click="currentTab = 'links'"
                                :class="currentTab === 'links' ? 'border-blue-500 text-blue-600 dark:text-blue-400' : 'border-transparent text-gray-500 hover:text-gray-700 dark:text-gray-400'"
                                class="py-4 px-1 border-b-2 font-medium text-sm transition-colors duration-200">
                                链接管理
                            </button>
                            <button 
                                @click="currentTab = 'config'"
                                :class="currentTab === 'config' ? 'border-blue-500 text-blue-600 dark:text-blue-400' : 'border-transparent text-gray-500 hover:text-gray-700 dark:text-gray-400'"
                                class="py-4 px-1 border-b-2 font-medium text-sm transition-colors duration-200">
                                系统配置
                            </button>
                            <button 
                                @click="currentTab = 'stats'"
                                :class="currentTab === 'stats' ? 'border-blue-500 text-blue-600 dark:text-blue-400' : 'border-transparent text-gray-500 hover:text-gray-700 dark:text-gray-400'"
                                class="py-4 px-1 border-b-2 font-medium text-sm transition-colors duration-200">
                                统计信息
                            </button>
                        </nav>
                    </div>

                    <!-- Tab Content -->
                    <div class="p-6">
                        
                        <!-- Subscription Tab -->
                        <div x-show="currentTab === 'subscription'" class="space-y-6">
                            <div class="flex items-center justify-between">
                                <h3 class="text-lg font-semibold text-gray-900 dark:text-white">订阅链接生成</h3>
                                <button @click="refreshData()" class="px-4 py-2 bg-blue-500 text-white rounded-lg hover:bg-blue-600 transition-colors duration-200">
                                    刷新数据
                                </button>
                            </div>
                            
                            <!-- Subscription Links -->
                            <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4">
                                <div class="bg-gray-50 dark:bg-gray-700/50 rounded-xl p-4">
                                    <div class="flex items-center justify-between mb-3">
                                        <h4 class="font-medium text-gray-900 dark:text-white">Clash</h4>
                                        <span class="px-2 py-1 bg-blue-100 dark:bg-blue-900/30 text-blue-700 dark:text-blue-300 text-xs rounded-full">YAML</span>
                                    </div>
                                    <div class="space-y-2">
                                        <input readonly :value="getSubscriptionUrl('clash')" class="w-full px-3 py-2 text-sm bg-white dark:bg-gray-800 border border-gray-300 dark:border-gray-600 rounded-lg">
                                        <div class="flex space-x-2">
                                            <button @click="copyToClipboard(getSubscriptionUrl('clash'))" class="flex-1 px-3 py-2 bg-blue-500 text-white text-sm rounded-lg hover:bg-blue-600 transition-colors">
                                                复制
                                            </button>
                                            <button @click="openUrl(getSubscriptionUrl('clash'))" class="px-3 py-2 bg-gray-500 text-white text-sm rounded-lg hover:bg-gray-600 transition-colors">
                                                打开
                                            </button>
                                        </div>
                                    </div>
                                </div>
                                
                                <div class="bg-gray-50 dark:bg-gray-700/50 rounded-xl p-4">
                                    <div class="flex items-center justify-between mb-3">
                                        <h4 class="font-medium text-gray-900 dark:text-white">Sing-box</h4>
                                        <span class="px-2 py-1 bg-green-100 dark:bg-green-900/30 text-green-700 dark:text-green-300 text-xs rounded-full">JSON</span>
                                    </div>
                                    <div class="space-y-2">
                                        <input readonly :value="getSubscriptionUrl('singbox')" class="w-full px-3 py-2 text-sm bg-white dark:bg-gray-800 border border-gray-300 dark:border-gray-600 rounded-lg">
                                        <div class="flex space-x-2">
                                            <button @click="copyToClipboard(getSubscriptionUrl('singbox'))" class="flex-1 px-3 py-2 bg-blue-500 text-white text-sm rounded-lg hover:bg-blue-600 transition-colors">
                                                复制
                                            </button>
                                            <button @click="openUrl(getSubscriptionUrl('singbox'))" class="px-3 py-2 bg-gray-500 text-white text-sm rounded-lg hover:bg-gray-600 transition-colors">
                                                打开
                                            </button>
                                        </div>
                                    </div>
                                </div>
                                
                                <div class="bg-gray-50 dark:bg-gray-700/50 rounded-xl p-4">
                                    <div class="flex items-center justify-between mb-3">
                                        <h4 class="font-medium text-gray-900 dark:text-white">Base64</h4>
                                        <span class="px-2 py-1 bg-purple-100 dark:bg-purple-900/30 text-purple-700 dark:text-purple-300 text-xs rounded-full">通用</span>
                                    </div>
                                    <div class="space-y-2">
                                        <input readonly :value="getSubscriptionUrl('base64')" class="w-full px-3 py-2 text-sm bg-white dark:bg-gray-800 border border-gray-300 dark:border-gray-600 rounded-lg">
                                        <div class="flex space-x-2">
                                            <button @click="copyToClipboard(getSubscriptionUrl('base64'))" class="flex-1 px-3 py-2 bg-blue-500 text-white text-sm rounded-lg hover:bg-blue-600 transition-colors">
                                                复制
                                            </button>
                                            <button @click="openUrl(getSubscriptionUrl('base64'))" class="px-3 py-2 bg-gray-500 text-white text-sm rounded-lg hover:bg-gray-600 transition-colors">
                                                打开
                                            </button>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Links Management Tab -->
                        <div x-show="currentTab === 'links'" class="space-y-6">
                            <div class="flex items-center justify-between">
                                <h3 class="text-lg font-semibold text-gray-900 dark:text-white">订阅源管理</h3>
                                <button @click="addNewLink()" class="px-4 py-2 bg-green-500 text-white rounded-lg hover:bg-green-600 transition-colors duration-200">
                                    添加链接
                                </button>
                            </div>
                            
                            <div class="space-y-3">
                                <template x-for="(link, index) in subscriptionLinks" :key="index">
                                    <div class="flex items-center space-x-3 p-3 bg-gray-50 dark:bg-gray-700/50 rounded-lg">
                                        <input 
                                            x-model="subscriptionLinks[index]" 
                                            type="url" 
                                            placeholder="https://example.com/subscription"
                                            class="flex-1 px-3 py-2 bg-white dark:bg-gray-800 border border-gray-300 dark:border-gray-600 rounded-lg text-sm">
                                        <button @click="removeLink(index)" class="px-3 py-2 bg-red-500 text-white rounded-lg hover:bg-red-600 transition-colors text-sm">
                                            删除
                                        </button>
                                    </div>
                                </template>
                            </div>
                            
                            <div class="flex justify-end">
                                <button @click="saveLinks()" class="px-6 py-2 bg-blue-500 text-white rounded-lg hover:bg-blue-600 transition-colors duration-200">
                                    保存链接
                                </button>
                            </div>
                        </div>

                        <!-- Config Tab -->
                        <div x-show="currentTab === 'config'" class="space-y-6">
                            <h3 class="text-lg font-semibold text-gray-900 dark:text-white">系统配置</h3>
                            
                            <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">
                                        服务名称
                                    </label>
                                    <input 
                                        x-model="config.subName"
                                        type="text" 
                                        class="w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-800 text-gray-900 dark:text-white">
                                </div>
                                
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">
                                        缓存时间 (小时)
                                    </label>
                                    <input 
                                        x-model="config.subUptime"
                                        type="number" 
                                        min="1" 
                                        max="72"
                                        class="w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-800 text-gray-900 dark:text-white">
                                </div>
                                
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">
                                        最大节点数
                                    </label>
                                    <input 
                                        x-model="config.maxNodes"
                                        type="number" 
                                        min="10" 
                                        max="1000"
                                        class="w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-800 text-gray-900 dark:text-white">
                                </div>
                                
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">
                                        转换 API
                                    </label>
                                    <input 
                                        x-model="config.subApi"
                                        type="text" 
                                        class="w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-800 text-gray-900 dark:text-white">
                                </div>
                            </div>
                            
                            <div class="space-y-4">
                                <div class="flex items-center">
                                    <input 
                                        x-model="config.enableCache"
                                        type="checkbox" 
                                        id="enableCache"
                                        class="w-4 h-4 text-blue-600 bg-gray-100 border-gray-300 rounded focus:ring-blue-500">
                                    <label for="enableCache" class="ml-2 text-sm font-medium text-gray-700 dark:text-gray-300">
                                        启用缓存
                                    </label>
                                </div>
                                
                                <div class="flex items-center">
                                    <input 
                                        x-model="config.enableStats"
                                        type="checkbox" 
                                        id="enableStats"
                                        class="w-4 h-4 text-blue-600 bg-gray-100 border-gray-300 rounded focus:ring-blue-500">
                                    <label for="enableStats" class="ml-2 text-sm font-medium text-gray-700 dark:text-gray-300">
                                        启用统计
                                    </label>
                                </div>
                                
                                <div class="flex items-center">
                                    <input 
                                        x-model="config.enableDedup"
                                        type="checkbox" 
                                        id="enableDedup"
                                        class="w-4 h-4 text-blue-600 bg-gray-100 border-gray-300 rounded focus:ring-blue-500">
                                    <label for="enableDedup" class="ml-2 text-sm font-medium text-gray-700 dark:text-gray-300">
                                        启用节点去重
                                    </label>
                                </div>
                            </div>
                            
                            <div class="flex justify-end">
                                <button @click="saveConfig()" class="px-6 py-2 bg-blue-500 text-white rounded-lg hover:bg-blue-600 transition-colors duration-200">
                                    保存配置
                                </button>
                            </div>
                        </div>

                        <!-- Stats Tab -->
                        <div x-show="currentTab === 'stats'" class="space-y-6">
                            <h3 class="text-lg font-semibold text-gray-900 dark:text-white">统计信息</h3>
                            
                            <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
                                <!-- 访问统计 -->
                                <div class="bg-gray-50 dark:bg-gray-700/50 rounded-xl p-6">
                                    <h4 class="text-lg font-medium text-gray-900 dark:text-white mb-4">访问统计</h4>
                                    <div class="space-y-3">
                                        <div class="flex justify-between">
                                            <span class="text-gray-600 dark:text-gray-400">总访问次数</span>
                                            <span class="font-semibold text-gray-900 dark:text-white" x-text="stats.totalAccess || 0"></span>
                                        </div>
                                        <div class="flex justify-between">
                                            <span class="text-gray-600 dark:text-gray-400">最后访问</span>
                                            <span class="font-semibold text-gray-900 dark:text-white" x-text="formatDate(stats.lastAccess)"></span>
                                        </div>
                                    </div>
                                </div>
                                
                                <!-- 客户端统计 -->
                                <div class="bg-gray-50 dark:bg-gray-700/50 rounded-xl p-6">
                                    <h4 class="text-lg font-medium text-gray-900 dark:text-white mb-4">客户端统计</h4>
                                    <div class="space-y-3">
                                        <template x-for="(count, client) in stats.clientStats" :key="client">
                                            <div class="flex justify-between">
                                                <span class="text-gray-600 dark:text-gray-400" x-text="client"></span>
                                                <span class="font-semibold text-gray-900 dark:text-white" x-text="count"></span>
                                            </div>
                                        </template>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </main>

    <!-- Toast Notifications -->
    <div x-show="notification.show" 
         x-transition:enter="transition ease-out duration-300"
         x-transition:enter-start="opacity-0 transform translate-y-2"
         x-transition:enter-end="opacity-100 transform translate-y-0"
         x-transition:leave="transition ease-in duration-200"
         x-transition:leave-start="opacity-100 transform translate-y-0"
         x-transition:leave-end="opacity-0 transform translate-y-2"
         class="fixed top-4 right-4 z-50">
        <div :class="notification.type === 'success' ? 'bg-green-500' : notification.type === 'error' ? 'bg-red-500' : 'bg-blue-500'" 
             class="text-white px-6 py-3 rounded-lg shadow-lg">
            <p x-text="notification.message"></p>
        </div>
    </div>

    <!-- JavaScript -->
    <script>
        function subManager() {
            return {
                // State
                darkMode: localStorage.getItem('darkMode') === 'true',
                isAuthenticated: false,
                token: '',
                loading: false,
                currentTab: 'subscription',
                
                // Data
                config: {},
                stats: {},
                subscriptionLinks: [],
                nodeCount: 0,
                
                // Notification
                notification: {
                    show: false,
                    type: 'info',
                    message: ''
                },
                
                // Init
                async init() {
                    // Check for token in URL
                    const urlParams = new URLSearchParams(window.location.search);
                    const urlToken = urlParams.get('token');
                    if (urlToken) {
                        this.token = urlToken;
                        await this.authenticate();
                    }
                    
                    // Apply dark mode
                    this.applyDarkMode();
                },
                
                // Authentication
                async authenticate() {
                    this.loading = true;
                    try {
                        const response = await fetch('/api/config', {
                            headers: {
                                'Authorization': `Bearer ${this.token}`
                            }
                        });
                        
                        if (response.ok) {
                            this.isAuthenticated = true;
                            await this.loadData();
                            this.showNotification('认证成功', 'success');
                        } else {
                            throw new Error('认证失败');
                        }
                    } catch (error) {
                        this.showNotification('认证失败，请检查令牌', 'error');
                    } finally {
                        this.loading = false;
                    }
                },
                
                // Data Loading
                async loadData() {
                    await Promise.all([
                        this.loadConfig(),
                        this.loadStats(),
                        this.loadLinks(),
                        this.loadNodes()
                    ]);
                },
                
                async loadConfig() {
                    try {
                        const response = await fetch('/api/config', {
                            headers: { 'Authorization': `Bearer ${this.token}` }
                        });
                        if (response.ok) {
                            const data = await response.json();
                            this.config = data.config || {};
                        }
                    } catch (error) {
                        console.error('Failed to load config:', error);
                    }
                },
                
                async loadStats() {
                    try {
                        const response = await fetch('/api/stats', {
                            headers: { 'Authorization': `Bearer ${this.token}` }
                        });
                        if (response.ok) {
                            const data = await response.json();
                            this.stats = data.stats || {};
                        }
                    } catch (error) {
                        console.error('Failed to load stats:', error);
                    }
                },
                
                async loadLinks() {
                    try {
                        const response = await fetch('/api/links', {
                            headers: { 'Authorization': `Bearer ${this.token}` }
                        });
                        if (response.ok) {
                            const data = await response.json();
                            this.subscriptionLinks = data.links || [];
                        }
                    } catch (error) {
                        console.error('Failed to load links:', error);
                    }
                },
                
                async loadNodes() {
                    try {
                        const response = await fetch('/api/nodes', {
                            headers: { 'Authorization': `Bearer ${this.token}` }
                        });
                        if (response.ok) {
                            const data = await response.json();
                            this.nodeCount = data.count || 0;
                        }
                    } catch (error) {
                        console.error('Failed to load nodes:', error);
                    }
                },
                
                // Actions
                async refreshData() {
                    await this.loadData();
                    this.showNotification('数据已刷新', 'success');
                },
                
                async saveConfig() {
                    try {
                        const response = await fetch('/api/config', {
                            method: 'POST',
                            headers: {
                                'Content-Type': 'application/json',
                                'Authorization': `Bearer ${this.token}`
                            },
                            body: JSON.stringify(this.config)
                        });
                        
                        if (response.ok) {
                            this.showNotification('配置已保存', 'success');
                        } else {
                            throw new Error('保存失败');
                        }
                    } catch (error) {
                        this.showNotification('保存失败', 'error');
                    }
                },
                
                async saveLinks() {
                    try {
                        const response = await fetch('/api/links', {
                            method: 'POST',
                            headers: {
                                'Content-Type': 'application/json',
                                'Authorization': `Bearer ${this.token}`
                            },
                            body: JSON.stringify({ links: this.subscriptionLinks.filter(link => link.trim()) })
                        });
                        
                        if (response.ok) {
                            this.showNotification('链接已保存', 'success');
                        } else {
                            throw new Error('保存失败');
                        }
                    } catch (error) {
                        this.showNotification('保存失败', 'error');
                    }
                },
                
                // Subscription URLs
                getSubscriptionUrl(format) {
                    const baseUrl = window.location.origin;
                    return `${baseUrl}/sub/${this.token}?target=${format}`;
                },
                
                // Link Management
                addNewLink() {
                    this.subscriptionLinks.push('');
                },
                
                removeLink(index) {
                    this.subscriptionLinks.splice(index, 1);
                },
                
                // Utilities
                async copyToClipboard(text) {
                    try {
                        await navigator.clipboard.writeText(text);
                        this.showNotification('已复制到剪贴板', 'success');
                    } catch (error) {
                        this.showNotification('复制失败', 'error');
                    }
                },
                
                openUrl(url) {
                    window.open(url, '_blank');
                },
                
                formatDate(timestamp) {
                    if (!timestamp) return '从未';
                    return new Date(timestamp).toLocaleString('zh-CN');
                },
                
                // Dark Mode
                toggleDarkMode() {
                    this.darkMode = !this.darkMode;
                    localStorage.setItem('darkMode', this.darkMode);
                    this.applyDarkMode();
                },
                
                applyDarkMode() {
                    if (this.darkMode) {
                        document.documentElement.classList.add('dark');
                    } else {
                        document.documentElement.classList.remove('dark');
                    }
                },
                
                // Notifications
                showNotification(message, type = 'info') {
                    this.notification = { show: true, message, type };
                    setTimeout(() => {
                        this.notification.show = false;
                    }, 3000);
                }
            }
        }
    </script>
</body>
</html>
